<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow">
    <title>상품 시안 확인 도구</title>
    
    <link rel="icon" type="image/svg+xml" href='data:image/svg+xml,<svg width="96" height="96" viewBox="0 0 96 96" fill="none" xmlns="http://www.w3.org/2000/svg"><g clip-path="url(%23clip0_81_5394)"><rect width="96" height="96" rx="23.04" fill="%234B5563"/><circle cx="60.672" cy="69.3126" r="7.296" fill="white"/><path d="M60.6711 52.2538C60.6727 48.9653 60.6711 44.4879 60.6711 41.1994H39.5838C38.9115 41.1994 38.7235 41.0374 38.7325 40.6197C38.7563 39.5091 38.9096 38.7961 39.2562 37.7383C40.2149 34.8061 42.1719 32.7544 44.854 31.3498C45.7577 30.8766 46.3247 30.6924 46.9403 30.5417C47.5368 30.3957 48.1774 30.2761 49.3102 30.2761L60.6711 30.276V19.3926L49.5805 19.3926C47.017 19.4569 46.7602 19.5064 45.4154 19.7657L45.3611 19.7761C40.5026 20.7157 36.296 22.8537 33.0559 26.6759C29.7268 30.6068 27.9049 35.1816 27.8763 40.3445C27.8095 52.2602 27.8572 64.6929 27.8461 76.6086H39.0448V52.7987C39.0448 52.4354 39.2244 52.2538 39.5837 52.2538H60.6711Z" fill="white"/></g><defs><clipPath id="clip0_81_5394"><rect width="96" height="96" rx="23.04" fill="white"/></clipPath></defs></svg>'>
    <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css" />
    <script src="https://cdn.tailwindcss.com?plugins=forms,typography"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: { sans: ['Pretendard', 'sans-serif'] },
                    colors: { primary: '#2563eb' }
                }
            }
        }
    </script>
    <style>
        body { font-family: 'Pretendard', sans-serif; font-feature-settings: "ss05"; }
        .modal-enter { opacity: 0; transform: scale(0.95); }
        .modal-enter-active { opacity: 1; transform: scale(1); transition: all 0.2s ease-out; }
        .modal-exit { opacity: 1; transform: scale(1); }
        .modal-exit-active { opacity: 0; transform: scale(0.95); transition: all 0.15s ease-in; }
    </style>
</head>
<body class="bg-gray-100 dark:bg-slate-900 flex items-center justify-center min-h-screen p-4">

    <div id="app-container" class="w-full max-w-7xl bg-white border border-gray-200 rounded-xl shadow-sm dark:bg-gray-800 dark:border-gray-700 flex flex-col md:flex-row overflow-hidden h-[90vh]">
        
        <div id="control-panel" class="w-full md:w-80 flex-shrink-0 border-r border-gray-200 dark:border-gray-700 flex flex-col bg-white dark:bg-gray-800 z-10">
            <div class="p-6 flex-1">
                <div class="mb-8">
                    <h1 class="text-xl font-bold text-gray-800 dark:text-white">상품 시안 확인 도구</h1>
                    <p class="mt-1 text-xs text-gray-500">ID 입력 후 미리보기 또는 캡처 모드를 실행하세요.</p>
                </div>

                <div class="space-y-6">
                    <div id="input-group" class="flex flex-col gap-2">
                        <div class="flex justify-between items-end px-1">
                            <label for="suffix-val" class="block text-sm font-medium dark:text-white">시안 ID</label>
                            
                            <button id="config-status" type="button" onclick="manualUpdateBaseUrl()" 
                                class="text-[11px] font-bold px-2 py-0.5 rounded-full bg-red-50 border border-red-200 text-red-600 hover:bg-red-100 cursor-pointer transition-colors flex items-center gap-1"
                                title="서버 연결 설정이 필요합니다.">
                                설정 필요 <span class="text-red-500">●</span>
                            </button>
                        </div>

                        <input type="text" id="suffix-val" 
                            class="py-3 px-4 block w-full border-gray-200 rounded-lg text-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-slate-900 dark:border-gray-700 dark:text-gray-400" 
                            placeholder="값 입력" autocomplete="off" autofocus>

                        <div class="flex justify-end px-1">
                            <button type="button" onclick="resetUI()" 
                                class="text-xs text-gray-500 hover:text-blue-600 flex items-center gap-1 transition-colors">
                                <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg>
                                입력 초기화
                            </button>
                        </div>
                    </div>

                    <div id="action-buttons" class="flex flex-col gap-3">
                        <button type="button" onclick="loadIframe()" 
                            class="w-full py-3 px-4 inline-flex justify-center items-center gap-x-2 text-sm font-semibold rounded-lg border border-transparent bg-blue-600 text-white hover:bg-blue-700 transition-all">
                            미리보기
                        </button>
                        <button type="button" onclick="openCleanWindow()" 
                            class="w-full py-3 px-4 inline-flex justify-center items-center gap-x-1 text-sm font-semibold rounded-lg border border-gray-200 bg-white text-gray-800 shadow-sm hover:bg-gray-50 dark:bg-slate-900 dark:border-gray-700 dark:text-white dark:hover:bg-gray-800 transition-all">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path></svg>
                            캡쳐 모드 실행
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div id="viewer-panel" class="flex-1 bg-gray-100 dark:bg-black relative">
            <iframe id="preview-frame" class="w-full h-full border-none" src="about:blank"></iframe>
            <div id="empty-state" class="absolute inset-0 flex flex-col items-center justify-center text-gray-400 pointer-events-none bg-gray-100 dark:bg-gray-900 z-10">
                <svg class="w-12 h-12 mb-2 opacity-20" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path></svg>
                <span class="text-sm">미리보기 영역</span>
            </div>
        </div>
    </div>

    <div id="custom-modal-overlay" class="fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm hidden opacity-0 transition-opacity duration-200">
        <div id="custom-modal-box" class="bg-white dark:bg-gray-800 rounded-xl shadow-2xl w-full max-w-sm mx-4 overflow-hidden transform scale-95 transition-transform duration-200 border border-gray-200 dark:border-gray-700">
            <div class="p-6">
                <h3 id="modal-title" class="text-lg font-bold text-gray-900 dark:text-white mb-2">알림</h3>
                <p id="modal-message" class="text-sm text-gray-500 dark:text-gray-300 whitespace-pre-line leading-relaxed"></p>
                
                <div id="modal-input-container" class="mt-4 hidden">
                    <input type="text" id="modal-input" class="py-3 px-4 block w-full border-gray-200 rounded-lg text-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-slate-900 dark:border-gray-700 dark:text-gray-300" placeholder="">
                </div>
            </div>
            
            <div class="bg-gray-50 dark:bg-gray-700/50 px-6 py-4 flex justify-end gap-3">
                <button id="modal-btn-cancel" class="py-2.5 px-4 inline-flex justify-center items-center gap-2 rounded-lg border border-gray-200 font-semibold bg-white text-gray-800 shadow-sm hover:bg-gray-50 transition-all text-sm dark:bg-slate-900 dark:border-gray-700 dark:text-white dark:hover:bg-gray-800 hidden">
                    취소
                </button>
                <button id="modal-btn-confirm" class="py-2.5 px-4 inline-flex justify-center items-center gap-2 rounded-lg border border-transparent font-semibold bg-blue-600 text-white hover:bg-blue-700 transition-all text-sm">
                    확인
                </button>
            </div>
        </div>
    </div>

<script>
        // --- Custom Modal System ---
        const AppModal = {
            overlay: document.getElementById('custom-modal-overlay'),
            box: document.getElementById('custom-modal-box'),
            title: document.getElementById('modal-title'),
            message: document.getElementById('modal-message'),
            inputContainer: document.getElementById('modal-input-container'),
            input: document.getElementById('modal-input'),
            btnConfirm: document.getElementById('modal-btn-confirm'),
            btnCancel: document.getElementById('modal-btn-cancel'),
            resolvePromise: null,

            show(type, text, defaultValue = "") {
                return new Promise((resolve) => {
                    this.resolvePromise = resolve;
                    
                    this.title.innerText = type === 'prompt' ? '설정' : '알림';
                    this.message.innerText = text;
                    this.input.value = defaultValue;
                    this.inputContainer.classList.add('hidden');
                    this.btnCancel.classList.add('hidden');
                    
                    if (type === 'confirm') {
                        this.btnCancel.classList.remove('hidden');
                        this.title.innerText = '확인';
                    } else if (type === 'prompt') {
                        this.inputContainer.classList.remove('hidden');
                        this.btnCancel.classList.remove('hidden');
                    }

                    this.overlay.classList.remove('hidden');
                    requestAnimationFrame(() => {
                        this.overlay.classList.remove('opacity-0');
                        this.box.classList.remove('scale-95');
                        this.box.classList.add('scale-100');
                    });

                    if (type === 'prompt') setTimeout(() => this.input.focus(), 100);
                    else setTimeout(() => this.btnConfirm.focus(), 100);
                });
            },

            close(result) {
                this.overlay.classList.add('opacity-0');
                this.box.classList.remove('scale-100');
                this.box.classList.add('scale-95');
                
                setTimeout(() => {
                    this.overlay.classList.add('hidden');
                    if (this.resolvePromise) this.resolvePromise(result);
                }, 200);
            },

            alert(text) { return this.show('alert', text); },
            confirm(text) { return this.show('confirm', text); },
            prompt(text, val) { return this.show('prompt', text, val); }
        };

        AppModal.btnConfirm.onclick = () => {
            if (!AppModal.inputContainer.classList.contains('hidden')) {
                AppModal.close(AppModal.input.value);
            } else {
                AppModal.close(true);
            }
        };
        AppModal.btnCancel.onclick = () => AppModal.close(null);
        AppModal.input.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') AppModal.btnConfirm.click();
        });


        // --- Configuration & Storage Logic ---
        const STORAGE_KEY = "preview_base_url";
        let BASE_URL = localStorage.getItem(STORAGE_KEY) || "";

        function initConfig() {
            const urlParams = new URLSearchParams(window.location.search);
            const paramHost = urlParams.get('host');

            if (paramHost) {
                BASE_URL = paramHost;
                localStorage.setItem(STORAGE_KEY, BASE_URL);
                
                let cleanPath = window.location.pathname;
                cleanPath = cleanPath.replace(/\/index\.html$/, '');
                cleanPath = cleanPath.replace(/\/$/, '');
                
                window.history.replaceState({}, document.title, cleanPath);
            }
            
            updateStatusUI();
            resetUI();
        }

        function updateStatusUI() {
            const statusBtn = document.getElementById('config-status');
            if (BASE_URL) {
                statusBtn.innerHTML = `서버 설정됨 <span class="text-green-500">●</span>`;
                statusBtn.className = "text-[11px] px-2 py-0.5 rounded-full bg-green-50 border border-green-200 text-green-700 hover:bg-green-100 cursor-pointer transition-colors flex items-center gap-1";
                statusBtn.title = "서버 주소가 설정되어 있습니다. ";
            } else {
                statusBtn.innerHTML = `설정 필요 <span class="text-red-500">●</span>`;
                statusBtn.className = "text-[11px] px-2 py-0.5 rounded-full bg-red-50 border border-red-200 text-red-600 hover:bg-red-100 cursor-pointer transition-colors flex items-center gap-1";
                statusBtn.title = "서버 연결 설정이 필요합니다.";
            }
        }

        async function manualUpdateBaseUrl() {
            const promptMsg = BASE_URL 
                ? "현재 서버 설정이 되어 있습니다.\n변경하려면 새 주소를 입력하고, 삭제하려면 빈 칸으로 확인을 누르세요."
                : "연결할 서버 주소를 입력하세요.";
            
            const newUrl = await AppModal.prompt(promptMsg, ""); 
            
            if (newUrl !== null) { 
                const trimmedUrl = newUrl.trim();
                
                if(trimmedUrl) {
                    BASE_URL = trimmedUrl;
                    localStorage.setItem(STORAGE_KEY, trimmedUrl);
                } else {
                    const isDelete = await AppModal.confirm("서버 설정을 삭제하시겠습니까?");
                    if(isDelete) {
                        BASE_URL = "";
                        localStorage.removeItem(STORAGE_KEY);
                    }
                }
                updateStatusUI();
            }
        }

        // --- Core Functions ---
        async function resetUI() {
            const input = document.getElementById('suffix-val');
            const frame = document.getElementById('preview-frame');
            
            input.value = "";
            frame.src = "about:blank";
            document.getElementById('empty-state').style.display = 'flex';
            input.focus();
        }

        async function getFullUrl() {
            if (!BASE_URL) {
                await AppModal.alert("서버 주소 설정이 필요합니다.\n상단의 '설정 필요' 뱃지를 클릭하거나, 주소 뒤에 '?host=주소'를 입력해 주세요.");
                return null;
            }

            const suffix = document.getElementById('suffix-val').value.trim();
            if (!suffix) {
                await AppModal.alert("시안 ID를 입력해주세요.");
                document.getElementById('suffix-val').focus();
                return null;
            }
            return BASE_URL + suffix;
        }

        async function loadIframe() {
            const url = await getFullUrl();
            if (url) {
                document.getElementById('empty-state').style.display = 'none';
                document.getElementById('preview-frame').src = url;
            }
        }

        async function openCleanWindow() {
            let url = await getFullUrl();
            if (!url) return;
            
            const separator = url.includes('?') ? '&' : '?';
            url = `${url}${separator}capture=true`;
            
            const width = 420;
            const height = 900;
            const left = (screen.width - width) / 2;
            const top = (screen.height - height) / 2;
            
            window.open(url, '_blank', `width=${width},height=${height},top=${top},left=${left},resizable=yes,scrollbars=yes,status=no,toolbar=no,menubar=no,location=no`);
        }

        window.onload = initConfig;
        
        document.getElementById('suffix-val').addEventListener("keypress", function(e) {
            if (e.key === "Enter") loadIframe();
        });
    </script>
</body>
</html>
